<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€±æœŸè¡¨ç¥å°„æ‰‹ - Periodic Table Sniper</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        body { margin: 0; padding: 0; background-color: #020617; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 1. åœ–æ¨™æ¨¡æ“¬å…ƒä»¶ (ä½¿ç”¨ Emoji/HTML æ›¿ä»£ Lucide) ---
        const IconWrapper = ({ children, className }) => (
            <span className={`inline-flex items-center justify-center ${className}`} style={{ width: '1.2em', height: '1.2em', lineHeight: '1' }}>
                {children}
            </span>
        );
        
        const Target = ({ className }) => <IconWrapper className={className}>ğŸ¯</IconWrapper>;
        const Trophy = ({ className }) => <IconWrapper className={className}>ğŸ†</IconWrapper>;
        const RotateCcw = ({ className }) => <IconWrapper className={className}>ğŸ”„</IconWrapper>;
        const Brain = ({ className }) => <IconWrapper className={className}>ğŸ§ </IconWrapper>;
        const Eye = ({ className }) => <IconWrapper className={className}>ğŸ‘ï¸</IconWrapper>;
        const EyeOff = ({ className }) => <IconWrapper className={className}>ğŸ™ˆ</IconWrapper>;
        const User = ({ className }) => <IconWrapper className={className}>ğŸ‘¤</IconWrapper>;
        const ListOrdered = ({ className }) => <IconWrapper className={className}>ğŸ“œ</IconWrapper>;

        // --- 2. è³‡æ–™åº« (é€±æœŸè¡¨) ---
        const periodicData = [
            { z: 1, symbol: 'H', name: 'æ°«', group: 1, period: 1, category: 'nonmetal', col: 1, row: 1 },
            { z: 2, symbol: 'He', name: 'æ°¦', group: 18, period: 1, category: 'noble-gas', col: 18, row: 1 },
            { z: 3, symbol: 'Li', name: 'é‹°', group: 1, period: 2, category: 'alkali-metal', col: 1, row: 2 },
            { z: 4, symbol: 'Be', name: 'éˆ¹', group: 2, period: 2, category: 'alkaline-earth', col: 2, row: 2 },
            { z: 5, symbol: 'B', name: 'ç¡¼', group: 13, period: 2, category: 'metalloid', col: 13, row: 2 },
            { z: 6, symbol: 'C', name: 'ç¢³', group: 14, period: 2, category: 'nonmetal', col: 14, row: 2 },
            { z: 7, symbol: 'N', name: 'æ°®', group: 15, period: 2, category: 'nonmetal', col: 15, row: 2 },
            { z: 8, symbol: 'O', name: 'æ°§', group: 16, period: 2, category: 'nonmetal', col: 16, row: 2 },
            { z: 9, symbol: 'F', name: 'æ°Ÿ', group: 17, period: 2, category: 'halogen', col: 17, row: 2 },
            { z: 10, symbol: 'Ne', name: 'æ°–', group: 18, period: 2, category: 'noble-gas', col: 18, row: 2 },
            { z: 11, symbol: 'Na', name: 'éˆ‰', group: 1, period: 3, category: 'alkali-metal', col: 1, row: 3 },
            { z: 12, symbol: 'Mg', name: 'é‚', group: 2, period: 3, category: 'alkaline-earth', col: 2, row: 3 },
            { z: 13, symbol: 'Al', name: 'é‹', group: 13, period: 3, category: 'post-transition', col: 13, row: 3 },
            { z: 14, symbol: 'Si', name: 'çŸ½', group: 14, period: 3, category: 'metalloid', col: 14, row: 3 },
            { z: 15, symbol: 'P', name: 'ç£·', group: 15, period: 3, category: 'nonmetal', col: 15, row: 3 },
            { z: 16, symbol: 'S', name: 'ç¡«', group: 16, period: 3, category: 'nonmetal', col: 16, row: 3 },
            { z: 17, symbol: 'Cl', name: 'æ°¯', group: 17, period: 3, category: 'halogen', col: 17, row: 3 },
            { z: 18, symbol: 'Ar', name: 'æ°¬', group: 18, period: 3, category: 'noble-gas', col: 18, row: 3 },
            // Period 4
            { z: 19, symbol: 'K', name: 'é‰€', group: 1, period: 4, category: 'alkali-metal', col: 1, row: 4 },
            { z: 20, symbol: 'Ca', name: 'éˆ£', group: 2, period: 4, category: 'alkaline-earth', col: 2, row: 4 },
            { z: 21, symbol: 'Sc', name: 'éˆ§', group: 3, period: 4, category: 'transition', col: 3, row: 4 },
            { z: 22, symbol: 'Ti', name: 'éˆ¦', group: 4, period: 4, category: 'transition', col: 4, row: 4 },
            { z: 23, symbol: 'V', name: 'é‡©', group: 5, period: 4, category: 'transition', col: 5, row: 4 },
            { z: 24, symbol: 'Cr', name: 'é‰»', group: 6, period: 4, category: 'transition', col: 6, row: 4 },
            { z: 25, symbol: 'Mn', name: 'éŒ³', group: 7, period: 4, category: 'transition', col: 7, row: 4 },
            { z: 26, symbol: 'Fe', name: 'éµ', group: 8, period: 4, category: 'transition', col: 8, row: 4 },
            { z: 27, symbol: 'Co', name: 'éˆ·', group: 9, period: 4, category: 'transition', col: 9, row: 4 },
            { z: 28, symbol: 'Ni', name: 'é³', group: 10, period: 4, category: 'transition', col: 10, row: 4 },
            { z: 29, symbol: 'Cu', name: 'éŠ…', group: 11, period: 4, category: 'transition', col: 11, row: 4 },
            { z: 30, symbol: 'Zn', name: 'é‹…', group: 12, period: 4, category: 'transition', col: 12, row: 4 },
            { z: 31, symbol: 'Ga', name: 'éµ', group: 13, period: 4, category: 'post-transition', col: 13, row: 4 },
            { z: 32, symbol: 'Ge', name: 'éº', group: 14, period: 4, category: 'metalloid', col: 14, row: 4 },
            { z: 33, symbol: 'As', name: 'ç ·', group: 15, period: 4, category: 'metalloid', col: 15, row: 4 },
            { z: 34, symbol: 'Se', name: 'ç¡’', group: 16, period: 4, category: 'nonmetal', col: 16, row: 4 },
            { z: 35, symbol: 'Br', name: 'æº´', group: 17, period: 4, category: 'halogen', col: 17, row: 4 },
            { z: 36, symbol: 'Kr', name: 'æ°ª', group: 18, period: 4, category: 'noble-gas', col: 18, row: 4 },
            // Selected common Period 5+ elements
            { z: 37, symbol: 'Rb', name: 'éŠ£', col: 1, row: 5 }, { z: 38, symbol: 'Sr', name: 'é¶', col: 2, row: 5 },
            { z: 47, symbol: 'Ag', name: 'éŠ€', col: 11, row: 5 }, { z: 48, symbol: 'Cd', name: 'é˜', col: 12, row: 5 },
            { z: 50, symbol: 'Sn', name: 'éŒ«', col: 14, row: 5 }, { z: 53, symbol: 'I', name: 'ç¢˜', col: 17, row: 5 },
            { z: 54, symbol: 'Xe', name: 'æ°™', col: 18, row: 5 },
            { z: 55, symbol: 'Cs', name: 'éŠ«', col: 1, row: 6 }, { z: 56, symbol: 'Ba', name: 'é‹‡', col: 2, row: 6 },
            { z: 74, symbol: 'W', name: 'é¢', col: 6, row: 6 }, { z: 78, symbol: 'Pt', name: 'é‰‘', col: 10, row: 6 },
            { z: 79, symbol: 'Au', name: 'é‡‘', col: 11, row: 6 }, { z: 80, symbol: 'Hg', name: 'æ±', col: 12, row: 6 },
            { z: 82, symbol: 'Pb', name: 'é‰›', col: 14, row: 6 }, { z: 86, symbol: 'Rn', name: 'æ°¡', col: 18, row: 6 },
            { z: 87, symbol: 'Fr', name: 'é…', col: 1, row: 7 }, { z: 88, symbol: 'Ra', name: 'é³', col: 2, row: 7 },
            { z: 92, symbol: 'U', name: 'éˆ¾', col: 6, row: 10, isActinide: true }, 
        ];

        // --- 3. æ¨¡æ“¬å¾Œç«¯ (Offline Mock) ---
        // æ³¨æ„ï¼šç‚ºäº†è®“ç¨‹å¼ç¢¼ç„¡éœ€ API Key å³å¯é‹ä½œï¼Œé€™è£¡ä½¿ç”¨ LocalStorage æ¨¡æ“¬ Firebase
        const MOCK_DB_KEY = 'periodic_sniper_leaderboard';
        
        const mockAuth = {
            currentUser: null,
            signInAnonymously: async () => {
                const mockUser = { uid: 'user_' + Math.random().toString(36).substr(2, 9) };
                mockAuth.currentUser = mockUser;
                return { user: mockUser };
            },
            onAuthStateChanged: (callback) => {
                // æ¨¡æ“¬å»¶é²ç™»å…¥
                setTimeout(() => {
                    if (!mockAuth.currentUser) mockAuth.signInAnonymously();
                    callback(mockAuth.currentUser);
                }, 500);
                return () => {}; // unsubscribe function
            }
        };

        const mockFirestore = {
            saveScore: async (userId, data) => {
                const scores = JSON.parse(localStorage.getItem(MOCK_DB_KEY) || '[]');
                // ç§»é™¤èˆŠæˆç¸¾ (å¦‚æœæœ‰çš„è©±)
                const newScores = scores.filter(s => s.id !== userId);
                newScores.push({ id: userId, ...data });
                localStorage.setItem(MOCK_DB_KEY, JSON.stringify(newScores));
                return true;
            },
            subscribeLeaderboard: (callback) => {
                const check = () => {
                    const scores = JSON.parse(localStorage.getItem(MOCK_DB_KEY) || '[]');
                    // ç°¡å–®æ’åºï¼šåˆ†æ•¸é«˜ -> ä½
                    scores.sort((a, b) => b.score - a.score);
                    callback(scores.slice(0, 50));
                };
                check();
                // æ¨¡æ“¬å³æ™‚æ›´æ–° (æ¯ 2 ç§’è®€å–ä¸€æ¬¡ Storage)
                const interval = setInterval(check, 2000);
                return () => clearInterval(interval);
            }
        };

        // --- 4. è¼”åŠ©é‚è¼¯ ---
        const generateGridMap = () => {
            const grid = [];
            for(let p=1; p<=7; p++) {
                for(let g=1; g<=18; g++) {
                    if (p===1 && (g>1 && g<18)) continue;
                    if ((p===2 || p===3) && (g>2 && g<13)) continue;
                    const element = periodicData.find(e => e.row === p && e.col === g);
                    grid.push({ row: p, col: g, data: element, type: 'main' });
                }
            }
            return grid;
        };

        // --- 5. å…ƒä»¶: æ’è¡Œæ¦œ ---
        const Leaderboard = ({ data, currentUserId }) => {
            return (
                <div className="bg-slate-800/90 border border-slate-700 rounded-xl p-4 w-full max-w-sm max-h-[60vh] overflow-y-auto">
                    <h3 className="text-white font-bold mb-3 flex items-center gap-2 sticky top-0 bg-slate-800/95 py-2">
                        <ListOrdered className="w-5 h-5 text-yellow-400" />
                        å³æ™‚æ’è¡Œæ¦œ (æœ¬æ©Ÿ)
                    </h3>
                    {data.length === 0 ? (
                        <div className="text-slate-500 text-sm text-center py-4">å°šç„¡ç´€éŒ„ï¼Œå¿«ä¾†æ¶ç¬¬ä¸€ï¼</div>
                    ) : (
                        <div className="space-y-2">
                            {data.map((entry, index) => (
                                <div 
                                    key={entry.id} 
                                    className={`flex justify-between items-center p-2 rounded-lg text-sm ${entry.id === currentUserId ? 'bg-blue-600/30 border border-blue-500/50' : 'bg-slate-700/50'}`}
                                >
                                    <div className="flex items-center gap-3">
                                        <span className={`font-mono font-bold w-6 text-center ${index < 3 ? 'text-yellow-400' : 'text-slate-500'}`}>
                                            {index + 1}
                                        </span>
                                        <span className="text-slate-200 font-medium truncate max-w-[120px]">
                                            {entry.name}
                                        </span>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="text-xs text-slate-400">{entry.difficulty === 'advanced' ? 'å¤§å¸«' : 'åˆç´š'}</span>
                                        <span className="font-mono font-bold text-green-400">{entry.score}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // --- 6. å…ƒä»¶: å…ƒç´ æ ¼å­ ---
        const ElementCell = ({ cell, mode, isActive, isRevealed, isError, onClick }) => {
            const { data } = cell;
            
            let baseClasses = "relative w-full h-full border border-gray-700 transition-all duration-200 cursor-pointer select-none rounded-sm flex items-center justify-center";
            let bgColor = "bg-gray-900";
            let textColor = "text-gray-400";
            let borderColor = "border-gray-700";

            if (isError) {
                bgColor = "bg-red-900/80 animate-pulse";
                borderColor = "border-red-500";
            } else if (isRevealed) {
                bgColor = "bg-green-600";
                textColor = "text-white";
                borderColor = "border-green-400";
            } else if (isActive && mode === 'beginner') {
                bgColor = "bg-gray-800 hover:bg-gray-700";
            } else if (isActive && mode === 'advanced') {
                bgColor = "bg-gray-800 hover:bg-gray-700";
            }

            if (!data) {
                return <div className="w-full h-full bg-gray-950/30 border border-gray-800/30 rounded-sm" />;
            }

            return (
                <div 
                    className={`${baseClasses} ${bgColor} ${borderColor}`}
                    style={{ 
                        gridColumnStart: cell.col, 
                        gridRowStart: cell.row,
                        aspectRatio: '1/1'
                    }}
                    onClick={() => onClick(data)}
                >
                    {(mode === 'beginner' || isRevealed) && (
                        <div className="flex flex-col items-center justify-center leading-none">
                            <span className={`text-[10px] md:text-xs font-bold absolute top-0.5 left-0.5 opacity-70 ${textColor}`}>{data.z}</span>
                            <span className={`text-sm md:text-lg font-bold ${textColor}`}>{data.symbol}</span>
                        </div>
                    )}
                    {mode === 'advanced' && !isRevealed && !isError && (
                        <div className="w-1 h-1 bg-gray-600 rounded-full opacity-50"></div>
                    )}
                </div>
            );
        };

        // --- 7. ä¸»æ‡‰ç”¨ç¨‹å¼ ---
        const PeriodicTableSniper = () => {
            const [gameState, setGameState] = useState('login'); // login, menu, playing, finished
            const [difficulty, setDifficulty] = useState('beginner');
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(60);
            const [currentTarget, setCurrentTarget] = useState(null);
            const [revealedIds, setRevealedIds] = useState([]);
            const [lastErrorId, setLastErrorId] = useState(null);
            const [combo, setCombo] = useState(0);
            
            // User & Data State
            const [user, setUser] = useState(null);
            const [playerName, setPlayerName] = useState("");
            const [leaderboard, setLeaderboard] = useState([]);
            const [isSubmitting, setIsSubmitting] = useState(false);

            const gridCells = useMemo(() => generateGridMap(), []);

            // Auth Initialization (Mock)
            useEffect(() => {
                const unsubscribe = mockAuth.onAuthStateChanged(setUser);
                return () => unsubscribe();
            }, []);

            // Leaderboard Sync (Mock)
            useEffect(() => {
                if (!user) return;
                const unsubscribe = mockFirestore.subscribeLeaderboard(setLeaderboard);
                return () => unsubscribe();
            }, [user]);

            // Game Logic
            const playSound = (type) => {
                // éŸ³æ•ˆæš«ç•™ (Web Audio API implementation needed)
            };

            const saveScoreToCloud = async (finalScore) => {
                if (!user || !playerName) return;
                setIsSubmitting(true);
                try {
                    await mockFirestore.saveScore(user.uid, {
                        name: playerName,
                        score: finalScore,
                        difficulty: difficulty,
                        timestamp: Date.now(),
                        accuracy: Math.round((revealedIds.length / (revealedIds.length + (60 - timeLeft)/5)) * 100) || 0
                    });
                } catch (e) {
                    console.error("Error saving score:", e);
                } finally {
                    setIsSubmitting(false);
                }
            };

            const generateQuestion = () => {
                let pool = periodicData;
                if (difficulty === 'beginner') {
                    pool = periodicData.filter(e => e.z <= 20);
                } 
                const available = pool.filter(e => !revealedIds.includes(e.z));
                
                if (available.length === 0) {
                    endGame(true);
                    return;
                }

                const nextTarget = available[Math.floor(Math.random() * available.length)];
                setCurrentTarget(nextTarget);
            };

            const startGame = () => {
                setScore(0);
                setTimeLeft(60);
                setRevealedIds([]);
                setCombo(0);
                setGameState('playing');
            };

            const endGame = (cleared = false) => {
                let finalScore = score;
                if (cleared) finalScore += timeLeft * 10;
                setScore(finalScore);
                setGameState('finished');
                saveScoreToCloud(finalScore); 
            };

            useEffect(() => {
                if (gameState !== 'playing') return;
                const timer = setInterval(() => {
                    setTimeLeft(prev => {
                        if (prev <= 1) {
                            clearInterval(timer);
                            endGame();
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, [gameState]);

            useEffect(() => {
                if (gameState === 'playing' && !currentTarget) {
                    generateQuestion();
                }
            }, [gameState, currentTarget]);

            useEffect(() => {
                if (gameState === 'menu') {
                    setCurrentTarget(null);
                }
            }, [gameState]);

            const handleCellClick = (element) => {
                if (gameState !== 'playing' || !currentTarget) return;
                if (revealedIds.includes(element.z)) return;

                if (element.z === currentTarget.z) {
                    setScore(prev => prev + 100 + (combo * 10));
                    setCombo(prev => prev + 1);
                    setRevealedIds(prev => [...prev, element.z]);
                    playSound('correct');
                    setCurrentTarget(null); 
                } else {
                    setScore(prev => Math.max(0, prev - 50));
                    setCombo(0);
                    setTimeLeft(prev => Math.max(0, prev - 2));
                    setLastErrorId(element.z);
                    playSound('wrong');
                    setTimeout(() => setLastErrorId(null), 500);
                }
            };

            const handleLogin = (e) => {
                e.preventDefault();
                if (playerName.trim().length > 0) {
                    setGameState('menu');
                }
            };

            return (
                <div className="flex flex-col h-screen w-full bg-slate-950 text-slate-100 font-sans overflow-hidden">
                    {/* Header */}
                    <header className="bg-slate-900 border-b border-slate-800 p-3 shadow-lg z-10">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-2 md:gap-3">
                                <div className="bg-blue-600 p-1.5 md:p-2 rounded-lg">
                                    <Target className="text-white" />
                                </div>
                                <div>
                                    <h1 className="text-lg md:text-xl font-bold tracking-tight text-white">é€±æœŸè¡¨ç¥å°„æ‰‹</h1>
                                    {playerName && <p className="text-xs text-blue-400">é¸æ‰‹: {playerName}</p>}
                                </div>
                            </div>

                            {gameState === 'playing' && (
                                <div className="flex items-center gap-3 md:gap-8 bg-slate-800 px-4 py-1.5 rounded-full border border-slate-700">
                                    <div className="text-center">
                                        <span className="text-[10px] text-slate-400 block uppercase">æ™‚é–“</span>
                                        <span className={`font-mono text-xl md:text-2xl font-bold ${timeLeft < 10 ? 'text-red-500 animate-pulse' : 'text-blue-400'}`}>
                                            {timeLeft}
                                        </span>
                                    </div>
                                    <div className="text-center min-w-[80px] md:min-w-[120px]">
                                        <span className="text-[10px] text-slate-400 block uppercase">å°‹æ‰¾</span>
                                        <span className="text-xl md:text-3xl font-bold text-yellow-400 animate-bounce block truncate px-2">
                                            {currentTarget ? currentTarget.name : '...'}
                                        </span>
                                    </div>
                                    <div className="text-center">
                                        <span className="text-[10px] text-slate-400 block uppercase">å¾—åˆ†</span>
                                        <span className="font-mono text-xl md:text-2xl font-bold text-green-400">{score}</span>
                                    </div>
                                </div>
                            )}

                            <div className="flex items-center gap-2">
                                {gameState === 'playing' && (
                                    <button onClick={() => setGameState('menu')} className="p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white">
                                        <RotateCcw />
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 overflow-hidden p-2 md:p-4 flex flex-col items-center justify-center relative">
                        
                        {/* Game Grid */}
                        <div className={`
                            transition-all duration-500 ease-in-out
                            ${gameState !== 'playing' ? 'opacity-20 blur-sm scale-95 pointer-events-none' : 'opacity-100 scale-100'}
                            relative bg-slate-900/50 p-2 md:p-6 rounded-xl border border-slate-800 shadow-2xl overflow-x-auto max-w-full
                        `}>
                            <div className="grid gap-0.5 md:gap-1" style={{ 
                                gridTemplateColumns: 'repeat(18, minmax(18px, 45px))',
                                gridTemplateRows: 'repeat(10, minmax(18px, 45px))'
                            }}>
                                {[1,2,3,4,5,6,7].map(p => (
                                    <div key={`p-${p}`} className="flex items-center justify-center text-[10px] text-slate-600 font-mono" style={{ gridColumn: 0, gridRow: p }}>
                                        {p}
                                    </div>
                                ))}
                                {gridCells.map((cell) => (
                                    <ElementCell 
                                        key={`${cell.row}-${cell.col}`}
                                        cell={cell}
                                        mode={difficulty}
                                        isActive={gameState === 'playing'}
                                        isRevealed={cell.data && revealedIds.includes(cell.data.z)}
                                        isError={cell.data && lastErrorId === cell.data.z}
                                        onClick={handleCellClick}
                                    />
                                ))}
                            </div>
                            {gameState === 'playing' && difficulty === 'advanced' && (
                                <div className="absolute top-2 right-2 md:top-4 md:right-4 text-[10px] md:text-xs text-slate-500 pointer-events-none">
                                    * ç›²æ¸¬æ¨¡å¼
                                </div>
                            )}
                        </div>

                        {/* Login Overlay */}
                        {gameState === 'login' && (
                            <div className="absolute inset-0 flex items-center justify-center bg-slate-950/80 backdrop-blur-md z-30">
                                <form onSubmit={handleLogin} className="bg-slate-900 border border-slate-700 p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center">
                                    <div className="mb-4 text-blue-500 flex justify-center"><span className="text-5xl">ğŸ‘¤</span></div>
                                    <h2 className="text-2xl font-bold text-white mb-6">è«‹è¼¸å…¥ä½ çš„åå­—</h2>
                                    <input 
                                        type="text" 
                                        value={playerName}
                                        onChange={(e) => setPlayerName(e.target.value)}
                                        placeholder="ä¾‹å¦‚ï¼š901 é™³å°æ˜"
                                        className="w-full bg-slate-800 border border-slate-600 text-white rounded-lg p-3 mb-6 text-center focus:outline-none focus:border-blue-500 placeholder:text-slate-600"
                                        autoFocus
                                    />
                                    <button 
                                        type="submit"
                                        disabled={!playerName.trim()}
                                        className="w-full bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl transition-all"
                                    >
                                        é€²å…¥éŠæˆ²
                                    </button>
                                </form>
                            </div>
                        )}

                        {/* Menu Overlay */}
                        {gameState === 'menu' && (
                            <div className="absolute inset-0 flex items-center justify-center bg-slate-950/60 backdrop-blur-sm z-20 overflow-y-auto p-4">
                                <div className="flex flex-col md:flex-row gap-6 max-w-4xl w-full items-start justify-center">
                                    
                                    {/* Menu Controls */}
                                    <div className="bg-slate-900 border border-slate-700 p-6 md:p-8 rounded-2xl shadow-2xl w-full max-w-md text-center shrink-0">
                                        <div className="mb-4 text-blue-500 flex justify-center"><span className="text-5xl">ğŸ§ </span></div>
                                        <h2 className="text-3xl font-bold text-white mb-2">æº–å‚™æŒ‘æˆ°</h2>
                                        <p className="text-slate-400 mb-6">æ­¡è¿ï¼Œ<span className="text-white font-bold">{playerName}</span>ï¼</p>

                                        <div className="grid grid-cols-2 gap-4 mb-8">
                                            <button 
                                                onClick={() => setDifficulty('beginner')}
                                                className={`p-3 md:p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${difficulty === 'beginner' ? 'border-blue-500 bg-blue-500/10 text-white' : 'border-slate-700 hover:border-slate-600 text-slate-400'}`}
                                            >
                                                <Eye />
                                                <span className="font-bold">åˆç´šå­¸å¾’</span>
                                                <span className="text-[10px] opacity-70">1-20 (é¡¯ç¤º)</span>
                                            </button>
                                            <button 
                                                onClick={() => setDifficulty('advanced')}
                                                className={`p-3 md:p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${difficulty === 'advanced' ? 'border-purple-500 bg-purple-500/10 text-white' : 'border-slate-700 hover:border-slate-600 text-slate-400'}`}
                                            >
                                                <EyeOff />
                                                <span className="font-bold">é€±æœŸè¡¨å¤§å¸«</span>
                                                <span className="text-[10px] opacity-70">å…¨ç¯„åœ (ç›²æ¸¬)</span>
                                            </button>
                                        </div>

                                        <button 
                                            onClick={startGame}
                                            className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-4 rounded-xl text-lg shadow-lg hover:shadow-blue-500/20 transition-all transform hover:scale-[1.02]"
                                        >
                                            é–‹å§‹æŒ‘æˆ°
                                        </button>
                                    </div>

                                    {/* Leaderboard Panel */}
                                    <Leaderboard data={leaderboard} currentUserId={user?.uid} />
                                </div>
                            </div>
                        )}

                        {/* Game Over Overlay */}
                        {gameState === 'finished' && (
                            <div className="absolute inset-0 flex items-center justify-center bg-slate-950/80 backdrop-blur-md z-30 p-4">
                                <div className="flex flex-col md:flex-row gap-6 max-w-4xl w-full items-center justify-center">
                                    <div className="bg-slate-900 border border-slate-700 p-8 rounded-2xl shadow-2xl max-w-md w-full text-center animate-in zoom-in duration-300">
                                        <div className="mb-4 text-yellow-400 flex justify-center"><span className="text-6xl">ğŸ†</span></div>
                                        <h2 className="text-3xl font-bold text-white mb-2">æŒ‘æˆ°çµæŸï¼</h2>
                                        <div className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500 mb-4">
                                            {score}
                                        </div>
                                        {isSubmitting && <p className="text-sm text-blue-400 animate-pulse mb-4">åˆ†æ•¸å„²å­˜ä¸­...</p>}
                                        
                                        <div className="flex justify-center gap-8 mb-8 text-sm">
                                            <div>
                                                <div className="text-slate-400 mb-1">é›£åº¦</div>
                                                <div className="font-bold text-white">{difficulty === 'beginner' ? 'åˆç´š' : 'å¤§å¸«'}</div>
                                            </div>
                                            <div>
                                                <div className="text-slate-400 mb-1">å‘½ä¸­ç‡</div>
                                                <div className="font-bold text-white">
                                                    {Math.round((revealedIds.length / (revealedIds.length + (60 - timeLeft)/5)) * 100) || 100}%
                                                </div>
                                            </div>
                                        </div>

                                        <button 
                                            onClick={() => setGameState('menu')}
                                            className="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-2"
                                        >
                                            <RotateCcw />
                                            å†è©¦ä¸€æ¬¡
                                        </button>
                                    </div>

                                    {/* Leaderboard Panel (Visible on Game Over too) */}
                                    <Leaderboard data={leaderboard} currentUserId={user?.uid} />
                                </div>
                            </div>
                        )}

                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PeriodicTableSniper />);
    </script>
</body>
</html>
