<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>週期表神射手 - 單機練習版</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* 自定義樣式 */
        body { margin: 0; padding: 0; background-color: #020617; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 1. Icons Components (SVG 替代 Lucide-react) ---
        const IconBase = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Target = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M2.5 9A10 10 0 0 0 12 18a10 10 0 0 0 9.5-9"/><path d="M12 18v4"/></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;
        const Brain = (props) => <IconBase {...props}><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.97-3.284"/><path d="M17.97 14.716A4 4 0 0 1 16 18"/></IconBase>;
        const Eye = (props) => <IconBase {...props}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const EyeOff = (props) => <IconBase {...props}><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7c.44 0 .88-.03 1.32-.09"/><line x1="2" x2="22" y1="2" y2="22"/></IconBase>;
        const User = (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
        const ListOrdered = (props) => <IconBase {...props}><line x1="10" x2="21" y1="6" y2="6"/><line x1="10" x2="21" y1="12" y2="12"/><line x1="10" x2="21" y1="18" y2="18"/><path d="M4 6h1v4"/><path d="M4 10h2"/><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;

        /**
         * 週期表資料庫
         */
        const periodicData = [
          { z: 1, symbol: 'H', name: '氫', group: 1, period: 1, category: 'nonmetal', col: 1, row: 1 },
          { z: 2, symbol: 'He', name: '氦', group: 18, period: 1, category: 'noble-gas', col: 18, row: 1 },
          { z: 3, symbol: 'Li', name: '鋰', group: 1, period: 2, category: 'alkali-metal', col: 1, row: 2 },
          { z: 4, symbol: 'Be', name: '鈹', group: 2, period: 2, category: 'alkaline-earth', col: 2, row: 2 },
          { z: 5, symbol: 'B', name: '硼', group: 13, period: 2, category: 'metalloid', col: 13, row: 2 },
          { z: 6, symbol: 'C', name: '碳', group: 14, period: 2, category: 'nonmetal', col: 14, row: 2 },
          { z: 7, symbol: 'N', name: '氮', group: 15, period: 2, category: 'nonmetal', col: 15, row: 2 },
          { z: 8, symbol: 'O', name: '氧', group: 16, period: 2, category: 'nonmetal', col: 16, row: 2 },
          { z: 9, symbol: 'F', name: '氟', group: 17, period: 2, category: 'halogen', col: 17, row: 2 },
          { z: 10, symbol: 'Ne', name: '氖', group: 18, period: 2, category: 'noble-gas', col: 18, row: 2 },
          { z: 11, symbol: 'Na', name: '鈉', group: 1, period: 3, category: 'alkali-metal', col: 1, row: 3 },
          { z: 12, symbol: 'Mg', name: '鎂', group: 2, period: 3, category: 'alkaline-earth', col: 2, row: 3 },
          { z: 13, symbol: 'Al', name: '鋁', group: 13, period: 3, category: 'post-transition', col: 13, row: 3 },
          { z: 14, symbol: 'Si', name: '矽', group: 14, period: 3, category: 'metalloid', col: 14, row: 3 },
          { z: 15, symbol: 'P', name: '磷', group: 15, period: 3, category: 'nonmetal', col: 15, row: 3 },
          { z: 16, symbol: 'S', name: '硫', group: 16, period: 3, category: 'nonmetal', col: 16, row: 3 },
          { z: 17, symbol: 'Cl', name: '氯', group: 17, period: 3, category: 'halogen', col: 17, row: 3 },
          { z: 18, symbol: 'Ar', name: '氬', group: 18, period: 3, category: 'noble-gas', col: 18, row: 3 },
          // Period 4
          { z: 19, symbol: 'K', name: '鉀', group: 1, period: 4, category: 'alkali-metal', col: 1, row: 4 },
          { z: 20, symbol: 'Ca', name: '鈣', group: 2, period: 4, category: 'alkaline-earth', col: 2, row: 4 },
          { z: 21, symbol: 'Sc', name: '鈧', group: 3, period: 4, category: 'transition', col: 3, row: 4 },
          { z: 22, symbol: 'Ti', name: '鈦', group: 4, period: 4, category: 'transition', col: 4, row: 4 },
          { z: 23, symbol: 'V', name: '釩', group: 5, period: 4, category: 'transition', col: 5, row: 4 },
          { z: 24, symbol: 'Cr', name: '鉻', group: 6, period: 4, category: 'transition', col: 6, row: 4 },
          { z: 25, symbol: 'Mn', name: '錳', group: 7, period: 4, category: 'transition', col: 7, row: 4 },
          { z: 26, symbol: 'Fe', name: '鐵', group: 8, period: 4, category: 'transition', col: 8, row: 4 },
          { z: 27, symbol: 'Co', name: '鈷', group: 9, period: 4, category: 'transition', col: 9, row: 4 },
          { z: 28, symbol: 'Ni', name: '鎳', group: 10, period: 4, category: 'transition', col: 10, row: 4 },
          { z: 29, symbol: 'Cu', name: '銅', group: 11, period: 4, category: 'transition', col: 11, row: 4 },
          { z: 30, symbol: 'Zn', name: '鋅', group: 12, period: 4, category: 'transition', col: 12, row: 4 },
          { z: 31, symbol: 'Ga', name: '鎵', group: 13, period: 4, category: 'post-transition', col: 13, row: 4 },
          { z: 32, symbol: 'Ge', name: '鍺', group: 14, period: 4, category: 'metalloid', col: 14, row: 4 },
          { z: 33, symbol: 'As', name: '砷', group: 15, period: 4, category: 'metalloid', col: 15, row: 4 },
          { z: 34, symbol: 'Se', name: '硒', group: 16, period: 4, category: 'nonmetal', col: 16, row: 4 },
          { z: 35, symbol: 'Br', name: '溴', group: 17, period: 4, category: 'halogen', col: 17, row: 4 },
          { z: 36, symbol: 'Kr', name: '氪', group: 18, period: 4, category: 'noble-gas', col: 18, row: 4 },
          // Selected common Period 5+ elements
          { z: 37, symbol: 'Rb', name: '銣', col: 1, row: 5 }, { z: 38, symbol: 'Sr', name: '鍶', col: 2, row: 5 },
          { z: 47, symbol: 'Ag', name: '銀', col: 11, row: 5 }, { z: 48, symbol: 'Cd', name: '鎘', col: 12, row: 5 },
          { z: 50, symbol: 'Sn', name: '錫', col: 14, row: 5 }, { z: 53, symbol: 'I', name: '碘', col: 17, row: 5 },
          { z: 54, symbol: 'Xe', name: '氙', col: 18, row: 5 },
          { z: 55, symbol: 'Cs', name: '銫', col: 1, row: 6 }, { z: 56, symbol: 'Ba', name: '鋇', col: 2, row: 6 },
          { z: 74, symbol: 'W', name: '鎢', col: 6, row: 6 }, { z: 78, symbol: 'Pt', name: '鉑', col: 10, row: 6 },
          { z: 79, symbol: 'Au', name: '金', col: 11, row: 6 }, { z: 80, symbol: 'Hg', name: '汞', col: 12, row: 6 },
          { z: 82, symbol: 'Pb', name: '鉛', col: 14, row: 6 }, { z: 86, symbol: 'Rn', name: '氡', col: 18, row: 6 },
          { z: 87, symbol: 'Fr', name: '鍅', col: 1, row: 7 }, { z: 88, symbol: 'Ra', name: '鐳', col: 2, row: 7 },
          { z: 92, symbol: 'U', name: '鈾', col: 6, row: 10, isActinide: true }, 
        ];

        // 預設的模擬排行榜資料
        const MOCK_LEADERBOARD = [
            { id: 'bot1', name: '門得列夫', score: 3500, difficulty: 'advanced', accuracy: 98 },
            { id: 'bot2', name: '居里夫人', score: 2800, difficulty: 'beginner', accuracy: 100 },
            { id: 'bot3', name: '波耳', score: 1500, difficulty: 'beginner', accuracy: 85 },
        ];

        // Helper to fill grid
        const generateGridMap = () => {
          const grid = [];
          for(let p=1; p<=7; p++) {
            for(let g=1; g<=18; g++) {
                if (p===1 && (g>1 && g<18)) continue;
                if ((p===2 || p===3) && (g>2 && g<13)) continue;
                const element = periodicData.find(e => e.row === p && e.col === g);
                grid.push({ row: p, col: g, data: element, type: 'main' });
            }
          }
          return grid;
        };

        // Leaderboard Component
        const Leaderboard = ({ data, currentName }) => {
            return (
                <div className="bg-slate-800/90 border border-slate-700 rounded-xl p-4 w-full max-w-sm max-h-[60vh] overflow-y-auto">
                    <h3 className="text-white font-bold mb-3 flex items-center gap-2 sticky top-0 bg-slate-800/95 py-2">
                        <ListOrdered className="w-5 h-5 text-yellow-400" />
                        本機排行榜
                    </h3>
                    {data.length === 0 ? (
                        <div className="text-slate-500 text-sm text-center py-4">尚無紀錄，快來搶第一！</div>
                    ) : (
                        <div className="space-y-2">
                            {data.map((entry, index) => (
                                <div 
                                    key={entry.id || index} 
                                    className={`flex justify-between items-center p-2 rounded-lg text-sm ${entry.name === currentName ? 'bg-blue-600/30 border border-blue-500/50' : 'bg-slate-700/50'}`}
                                >
                                    <div className="flex items-center gap-3">
                                        <span className={`font-mono font-bold w-6 text-center ${index < 3 ? 'text-yellow-400' : 'text-slate-500'}`}>
                                            {index + 1}
                                        </span>
                                        <span className="text-slate-200 font-medium truncate max-w-[120px]">
                                            {entry.name}
                                        </span>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="text-xs text-slate-400">{entry.difficulty === 'advanced' ? '大師' : '初級'}</span>
                                        <span className="font-mono font-bold text-green-400">{entry.score}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const ElementCell = ({ cell, mode, isActive, isRevealed, isError, isHint, onClick }) => {
            const { data } = cell;
            
            let baseClasses = "relative w-full h-full border border-gray-700 transition-all duration-200 cursor-pointer select-none rounded-sm flex items-center justify-center";
            let bgColor = "bg-gray-900";
            let textColor = "text-gray-400";
            let borderColor = "border-gray-700";

            if (isError) {
                bgColor = "bg-red-900/80 animate-pulse";
                borderColor = "border-red-500";
            } else if (isRevealed) {
                bgColor = "bg-green-600";
                textColor = "text-white";
                borderColor = "border-green-400";
            } else if (isHint && isActive) {
                bgColor = "bg-yellow-500/30 animate-pulse";
                borderColor = "border-yellow-400 border-2";
            } else if (isActive && mode === 'beginner') {
                bgColor = "bg-gray-800 hover:bg-gray-700";
            } else if (isActive && mode === 'advanced') {
                bgColor = "bg-gray-800 hover:bg-gray-700";
            }

            if (!data) {
                return <div className="w-full h-full bg-gray-950/30 border border-gray-800/30 rounded-sm" />;
            }

            return (
                <div 
                    className={`${baseClasses} ${bgColor} ${borderColor}`}
                    style={{ 
                        gridColumnStart: cell.col, 
                        gridRowStart: cell.row,
                        aspectRatio: '1/1'
                    }}
                    onClick={() => onClick(data)}
                >
                    {(mode === 'beginner' || isRevealed) && (
                        <div className="flex flex-col items-center justify-center leading-none">
                            <span className={`text-[10px] md:text-xs font-bold absolute top-0.5 left-0.5 opacity-70 ${textColor}`}>{data.z}</span>
                            <span className={`text-sm md:text-lg font-bold ${textColor}`}>{data.symbol}</span>
                        </div>
                    )}
                    {mode === 'advanced' && !isRevealed && !isError && (
                        <div className={`w-1 h-1 rounded-full ${isHint ? 'bg-yellow-400 w-2 h-2 animate-bounce' : 'bg-gray-600 opacity-50'}`}></div>
                    )}
                </div>
            );
        };

        function PeriodicTableSniper() {
          const [gameState, setGameState] = useState('login');
          const [difficulty, setDifficulty] = useState('beginner');
          const [score, setScore] = useState(0);
          const [timeLeft, setTimeLeft] = useState(120);
          const [currentTarget, setCurrentTarget] = useState(null);
          const [revealedIds, setRevealedIds] = useState([]);
          const [lastErrorId, setLastErrorId] = useState(null);
          const [mistakes, setMistakes] = useState(0);
          const [combo, setCombo] = useState(0);
          const [showHint, setShowHint] = useState(false);
          
          const [playerName, setPlayerName] = useState("");
          const [leaderboard, setLeaderboard] = useState([]);
          const [isSubmitting, setIsSubmitting] = useState(false);

          const gridCells = useMemo(() => generateGridMap(), []);

          // --- Local Storage Leaderboard Logic ---
          useEffect(() => {
            // Load from LocalStorage on mount
            const savedScores = localStorage.getItem('periodic_game_scores');
            if (savedScores) {
                setLeaderboard(JSON.parse(savedScores));
            } else {
                // Initialize with mock data if empty
                setLeaderboard(MOCK_LEADERBOARD);
                localStorage.setItem('periodic_game_scores', JSON.stringify(MOCK_LEADERBOARD));
            }
          }, []);

          // --- Hint Logic ---
          useEffect(() => {
            setShowHint(false);
            if (gameState !== 'playing' || !currentTarget) return;
            const hintTimer = setTimeout(() => {
                setShowHint(true);
            }, 5000);
            return () => clearTimeout(hintTimer);
          }, [currentTarget, gameState]);

          const saveScoreToLocal = (finalScore) => {
            if (!playerName) return;
            setIsSubmitting(true);
            
            // Calculate accuracy
            const totalAttempts = revealedIds.length + mistakes;
            const accuracy = totalAttempts > 0 
                ? Math.round((revealedIds.length / totalAttempts) * 100) 
                : 0;

            const newEntry = {
                id: Date.now().toString(), // Simple unique ID
                name: playerName,
                score: finalScore,
                difficulty: difficulty,
                timestamp: new Date().toISOString(),
                accuracy: accuracy
            };

            // Update State & LocalStorage
            const newLeaderboard = [...leaderboard, newEntry]
                .sort((a, b) => b.score - a.score)
                .slice(0, 50); // Keep top 50

            setLeaderboard(newLeaderboard);
            localStorage.setItem('periodic_game_scores', JSON.stringify(newLeaderboard));
            
            // Simulate network delay for effect
            setTimeout(() => {
                setIsSubmitting(false);
            }, 800);
          };

          const generateQuestion = () => {
            let pool = periodicData;
            if (difficulty === 'beginner') {
                pool = periodicData.filter(e => e.z <= 20);
            } else {
                const specialMetals = ['Au', 'Ag', 'Pt', 'Hg', 'Cd', 'W'];
                pool = periodicData.filter(e => {
                    const isMainGroup = (e.col <= 2 || e.col >= 13);
                    const isFirstTransition = (e.z >= 21 && e.z <= 30);
                    const isSpecial = specialMetals.includes(e.symbol);
                    return isMainGroup || isFirstTransition || isSpecial;
                });
            }

            const available = pool.filter(e => !revealedIds.includes(e.z));
            
            if (available.length === 0) {
                endGame(true);
                return;
            }

            const nextTarget = available[Math.floor(Math.random() * available.length)];
            setCurrentTarget(nextTarget);
          };

          const startGame = () => {
            setScore(0);
            setTimeLeft(120);
            setRevealedIds([]);
            setMistakes(0);
            setCombo(0);
            setGameState('playing');
          };

          const endGame = (cleared = false) => {
            let finalScore = score;
            if (cleared) finalScore += timeLeft * 10;
            setScore(finalScore);
            setGameState('finished');
            saveScoreToLocal(finalScore);
          };

          useEffect(() => {
            if (gameState !== 'playing') return;
            const timer = setInterval(() => {
                setTimeLeft(prev => {
                    if (prev <= 1) {
                        clearInterval(timer);
                        endGame();
                        return 0;
                    }
                    return prev - 1;
                });
            }, 1000);
            return () => clearInterval(timer);
          }, [gameState]);

          useEffect(() => {
            if (gameState === 'playing' && !currentTarget) {
                generateQuestion();
            }
          }, [gameState, currentTarget]);

          useEffect(() => {
            if (gameState === 'menu') {
                setCurrentTarget(null);
            }
          }, [gameState]);

          const handleCellClick = (element) => {
            if (gameState !== 'playing' || !currentTarget) return;
            if (revealedIds.includes(element.z)) return;

            if (element.z === currentTarget.z) {
                setScore(prev => prev + 100 + (combo * 10));
                setCombo(prev => prev + 1);
                setRevealedIds(prev => [...prev, element.z]);
                setTimeLeft(prev => prev + 3);
                setCurrentTarget(null); 
            } else {
                setScore(prev => Math.max(0, prev - 50));
                setCombo(0);
                setTimeLeft(prev => Math.max(0, prev - 2));
                setMistakes(prev => prev + 1);
                setLastErrorId(element.z);
                setTimeout(() => setLastErrorId(null), 500);
            }
          };

          const handleLogin = (e) => {
            e.preventDefault();
            if (playerName.trim().length > 0) {
                setGameState('menu');
            }
          };

          return (
            <div className="flex flex-col h-screen w-full bg-slate-950 text-slate-100 font-sans overflow-hidden">
                {/* Header */}
                <header className="bg-slate-900 border-b border-slate-800 p-3 shadow-lg z-10">
                    <div className="max-w-6xl mx-auto flex justify-between items-center">
                        <div className="flex items-center gap-2 md:gap-3">
                            <div className="bg-blue-600 p-1.5 md:p-2 rounded-lg">
                                <Target className="w-5 h-5 md:w-6 md:h-6 text-white" />
                            </div>
                            <div>
                                <h1 className="text-lg md:text-xl font-bold tracking-tight text-white">週期表神射手</h1>
                                {playerName && <p className="text-xs text-blue-400">選手: {playerName}</p>}
                            </div>
                        </div>

                        {gameState === 'playing' && (
                            <div className="flex items-center gap-3 md:gap-8 bg-slate-800 px-4 py-1.5 rounded-full border border-slate-700">
                                <div className="text-center">
                                    <span className="text-[10px] text-slate-400 block uppercase">時間</span>
                                    <span className={`font-mono text-xl md:text-2xl font-bold flex items-center gap-1 ${timeLeft < 10 ? 'text-red-500 animate-pulse' : 'text-blue-400'}`}>
                                        {timeLeft} <span className="text-xs font-normal opacity-50">s</span>
                                    </span>
                                </div>
                                <div className="text-center min-w-[80px] md:min-w-[120px]">
                                    <span className="text-[10px] text-slate-400 block uppercase">尋找</span>
                                    <span className="text-xl md:text-3xl font-bold text-yellow-400 animate-bounce block truncate px-2">
                                        {currentTarget ? currentTarget.name : '...'}
                                    </span>
                                </div>
                                <div className="text-center">
                                    <span className="text-[10px] text-slate-400 block uppercase">得分</span>
                                    <span className="font-mono text-xl md:text-2xl font-bold text-green-400">{score}</span>
                                </div>
                            </div>
                        )}

                        <div className="flex items-center gap-2">
                            {gameState === 'playing' && (
                                <button onClick={() => setGameState('menu')} className="p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white">
                                    <RotateCcw className="w-5 h-5" />
                                </button>
                            )}
                        </div>
                    </div>
                </header>

                {/* Main Content */}
                <main className="flex-1 overflow-hidden p-2 md:p-4 flex flex-col items-center justify-center relative">
                    
                    {/* Game Grid */}
                    <div className={`
                        transition-all duration-500 ease-in-out
                        ${gameState !== 'playing' ? 'opacity-20 blur-sm scale-95 pointer-events-none' : 'opacity-100 scale-100'}
                        relative bg-slate-900/50 p-2 md:p-6 rounded-xl border border-slate-800 shadow-2xl overflow-x-auto max-w-full
                    `}>
                        <div className="grid gap-0.5 md:gap-1" style={{ 
                            gridTemplateColumns: 'repeat(18, minmax(18px, 45px))',
                            gridTemplateRows: 'repeat(10, minmax(18px, 45px))'
                        }}>
                            {[1,2,3,4,5,6,7].map(p => (
                                <div key={`p-${p}`} className="flex items-center justify-center text-[10px] text-slate-600 font-mono" style={{ gridColumn: 0, gridRow: p }}>
                                    {p}
                                </div>
                            ))}
                            {gridCells.map((cell) => (
                                <ElementCell 
                                    key={`${cell.row}-${cell.col}`}
                                    cell={cell}
                                    mode={difficulty}
                                    isActive={gameState === 'playing'}
                                    isRevealed={cell.data && revealedIds.includes(cell.data.z)}
                                    isError={cell.data && lastErrorId === cell.data.z}
                                    isHint={showHint && cell.data && currentTarget && cell.data.z === currentTarget.z}
                                    onClick={handleCellClick}
                                />
                            ))}
                        </div>
                        {gameState === 'playing' && difficulty === 'advanced' && (
                             <div className="absolute top-2 right-2 md:top-4 md:right-4 text-[10px] md:text-xs text-slate-500 pointer-events-none flex flex-col items-end">
                                <span>* 盲測模式 (答對 +3秒)</span>
                                {showHint && <span className="text-yellow-400 animate-pulse flex items-center gap-1"><Zap className="w-3 h-3"/> 提示已開啟</span>}
                             </div>
                        )}
                    </div>

                    {/* Login Overlay */}
                    {gameState === 'login' && (
                        <div className="absolute inset-0 flex items-center justify-center bg-slate-950/80 backdrop-blur-md z-30">
                            <form onSubmit={handleLogin} className="bg-slate-900 border border-slate-700 p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center">
                                <User className="w-12 h-12 text-blue-500 mx-auto mb-4" />
                                <h2 className="text-2xl font-bold text-white mb-6">請輸入你的名字</h2>
                                <input 
                                    type="text" 
                                    value={playerName}
                                    onChange={(e) => setPlayerName(e.target.value)}
                                    placeholder="例如：901 陳小明"
                                    className="w-full bg-slate-800 border border-slate-600 text-white rounded-lg p-3 mb-6 text-center focus:outline-none focus:border-blue-500 placeholder:text-slate-600"
                                    autoFocus
                                />
                                <button 
                                    type="submit"
                                    disabled={!playerName.trim()}
                                    className="w-full bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl transition-all"
                                >
                                    進入遊戲
                                </button>
                            </form>
                        </div>
                    )}

                    {/* Menu Overlay */}
                    {gameState === 'menu' && (
                        <div className="absolute inset-0 flex items-center justify-center bg-slate-950/60 backdrop-blur-sm z-20 overflow-y-auto p-4">
                            <div className="flex flex-col md:flex-row gap-6 max-w-4xl w-full items-start justify-center">
                                
                                {/* Menu Controls */}
                                <div className="bg-slate-900 border border-slate-700 p-6 md:p-8 rounded-2xl shadow-2xl w-full max-w-md text-center shrink-0">
                                    <Brain className="w-12 h-12 text-blue-500 mx-auto mb-4" />
                                    <h2 className="text-3xl font-bold text-white mb-2">準備挑戰</h2>
                                    <p className="text-slate-400 mb-6">歡迎，<span className="text-white font-bold">{playerName}</span>！</p>

                                    <div className="grid grid-cols-2 gap-4 mb-8">
                                        <button 
                                            onClick={() => setDifficulty('beginner')}
                                            className={`p-3 md:p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${difficulty === 'beginner' ? 'border-blue-500 bg-blue-500/10 text-white' : 'border-slate-700 hover:border-slate-600 text-slate-400'}`}
                                        >
                                            <Eye className="w-6 h-6" />
                                            <span className="font-bold">初級學徒</span>
                                            <span className="text-[10px] opacity-70">1-20 (顯示)</span>
                                        </button>
                                        <button 
                                            onClick={() => setDifficulty('advanced')}
                                            className={`p-3 md:p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${difficulty === 'advanced' ? 'border-purple-500 bg-purple-500/10 text-white' : 'border-slate-700 hover:border-slate-600 text-slate-400'}`}
                                        >
                                            <EyeOff className="w-6 h-6" />
                                            <span className="font-bold">週期表大師</span>
                                            <span className="text-[10px] opacity-70">主族+過渡+常見 (盲測)</span>
                                        </button>
                                    </div>

                                    <button 
                                        onClick={startGame}
                                        className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-4 rounded-xl text-lg shadow-lg hover:shadow-blue-500/20 transition-all transform hover:scale-[1.02]"
                                    >
                                        開始挑戰 (2分鐘)
                                    </button>
                                </div>

                                {/* Leaderboard Panel */}
                                <Leaderboard data={leaderboard} currentName={playerName} />
                            </div>
                        </div>
                    )}

                    {/* Game Over Overlay */}
                    {gameState === 'finished' && (
                        <div className="absolute inset-0 flex items-center justify-center bg-slate-950/80 backdrop-blur-md z-30 p-4">
                            <div className="flex flex-col md:flex-row gap-6 max-w-4xl w-full items-center justify-center">
                                <div className="bg-slate-900 border border-slate-700 p-8 rounded-2xl shadow-2xl max-w-md w-full text-center animate-in zoom-in duration-300">
                                    <Trophy className="w-16 h-16 text-yellow-400 mx-auto mb-4" />
                                    <h2 className="text-3xl font-bold text-white mb-2">挑戰結束！</h2>
                                    <div className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500 mb-4">
                                        {score}
                                    </div>
                                    {isSubmitting && <p className="text-sm text-blue-400 animate-pulse mb-4">分數儲存中...</p>}
                                    
                                    <div className="flex justify-center gap-8 mb-8 text-sm">
                                        <div>
                                            <div className="text-slate-400 mb-1">難度</div>
                                            <div className="font-bold text-white">{difficulty === 'beginner' ? '初級' : '大師'}</div>
                                        </div>
                                        <div>
                                            <div className="text-slate-400 mb-1">命中率</div>
                                            <div className="font-bold text-white">
                                                { (revealedIds.length + mistakes) > 0 
                                                    ? Math.round((revealedIds.length / (revealedIds.length + mistakes)) * 100) 
                                                    : 0 
                                                }%
                                            </div>
                                        </div>
                                    </div>

                                    <button 
                                        onClick={() => setGameState('menu')}
                                        className="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-2"
                                    >
                                        <RotateCcw className="w-5 h-5" />
                                        再試一次
                                    </button>
                                </div>

                                {/* Leaderboard Panel (Visible on Game Over too) */}
                                <Leaderboard data={leaderboard} currentName={playerName} />
                            </div>
                        </div>
                    )}

                </main>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PeriodicTableSniper />);
    </script>
</body>
</html>
